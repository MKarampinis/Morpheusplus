<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Food Preparation & Cooking - Day 1 Learning</title>
    <meta name="description" content="Interactive learning module for Basic Food Preparation and Cooking - OCN London Level 1">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .module-card:hover { transform: translateY(-2px); }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>
    
    <script>
        // App State
        let state = {
            currentModule: 'home',
            progress: { quiz: 0, matching: 0, fillBlanks: 0, video: 0, caseStudy: 0, reflection: 0 },
            quizAnswers: {},
            matchingSelections: {},
            fillBlanksAnswers: {},
            reflectionText: {},
            showFeedback: false,
            caseStudyQuestion: 0,
            caseStudyAnswers: {},
            caseStudyFeedback: null
        };

        // Load saved progress from localStorage
        function loadProgress() {
            try {
                const saved = localStorage.getItem('cooking-app-progress');
                if (saved) {
                    const data = JSON.parse(saved);
                    state.progress = data.progress || state.progress;
                    state.reflectionText = data.reflectionText || {};
                }
            } catch (e) {
                console.log('No saved progress found');
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            try {
                localStorage.setItem('cooking-app-progress', JSON.stringify({
                    progress: state.progress,
                    reflectionText: state.reflectionText,
                    lastUpdated: new Date().toISOString()
                }));
            } catch (e) {
                console.log('Could not save progress');
            }
        }

        // Quiz Data
        const quizQuestions = [
            { id: 1, question: "Which cooking method uses water at 100¬∞C with vigorous bubbling?", options: ["Poaching", "Simmering", "Boiling", "Steaming"], correct: 2 },
            { id: 2, question: "What is the main advantage of steaming vegetables?", options: ["Creates browning", "Preserves nutrients and colour", "Fastest method", "Adds fat for flavour"], correct: 1 },
            { id: 3, question: "Which method combines dry heat (browning) then wet heat (slow cooking)?", options: ["Roasting", "Braising", "Grilling", "Baking"], correct: 1 },
            { id: 4, question: "What temperature range is typical for poaching?", options: ["100¬∞C", "85-95¬∞C", "70-85¬∞C", "150-200¬∞C"], correct: 2 },
            { id: 5, question: "Which dry method applies heat from below and creates char marks?", options: ["Broiling", "Baking", "Grilling", "Roasting"], correct: 2 }
        ];

        // Matching Data
        const matchingPairs = [
            { id: 1, method: "Braising", produce: "Beef brisket", explanation: "Slow moist heat breaks down tough connective tissue" },
            { id: 2, method: "Steaming", produce: "Broccoli", explanation: "Preserves nutrients and bright green colour" },
            { id: 3, method: "Poaching", produce: "Eggs", explanation: "Gentle heat keeps yolks runny while whites set" },
            { id: 4, method: "Grilling", produce: "Steak", explanation: "High direct heat creates char and sears quickly" },
            { id: 5, method: "Saut√©ing", produce: "Spinach", explanation: "Quick cooking maintains texture" }
        ];

        // Fill Blanks Data
        const fillBlanksData = [
            { id: 1, text: "Wet cooking methods use water, stock, or ___ as the cooking medium.", answer: "steam", options: ["steam", "oil", "air", "metal"] },
            { id: 2, text: "The Maillard reaction creates ___ and can only occur above 140¬∞C.", answer: "browning", options: ["browning", "boiling", "steaming", "moisture"] },
            { id: 3, text: "Simmering occurs at temperatures between 85-95¬∞C with ___ bubbles.", answer: "gentle", options: ["rapid", "gentle", "no", "violent"] },
            { id: 4, text: "Deep frying requires food to be completely ___ in hot fat.", answer: "submerged", options: ["floating", "submerged", "touching", "above"] },
            { id: 5, text: "Tough cuts of meat are best suited to ___ cooking methods.", answer: "braising", options: ["grilling", "braising", "saut√©ing", "broiling"] }
        ];

        // Case Study
        const caseStudy = {
            scenario: "You're working in a busy restaurant kitchen. The head chef asks you to prepare three dishes: salmon fillet for a delicate starter, beef shin for the evening's special, and mixed vegetables as a side dish. The vegetables need to retain their bright colours.",
            questions: [
                { id: 1, question: "What method would you use for the salmon fillet?", options: [
                    { text: "Deep frying - quick and crispy", correct: false, feedback: "Deep frying would be too aggressive for delicate salmon." },
                    { text: "Poaching - gentle heat preserves texture", correct: true, feedback: "Excellent! Poaching is perfect for delicate fish." },
                    { text: "Boiling - fast and efficient", correct: false, feedback: "Boiling is too aggressive for delicate fish." },
                    { text: "Braising - develops deep flavour", correct: false, feedback: "Braising takes too long for a starter." }
                ]},
                { id: 2, question: "What method would you use for the beef shin?", options: [
                    { text: "Grilling - char marks look great", correct: false, feedback: "Grilling won't break down tough connective tissue." },
                    { text: "Saut√©ing - quick and flavourful", correct: false, feedback: "Saut√©ing is too quick for tough cuts." },
                    { text: "Braising - slow cooking breaks down collagen", correct: true, feedback: "Perfect! Braising transforms tough meat into tender results." },
                    { text: "Steaming - healthy option", correct: false, feedback: "Steaming won't develop deep flavours." }
                ]},
                { id: 3, question: "What method for vegetables to keep bright colours?", options: [
                    { text: "Roasting - caramelises nicely", correct: false, feedback: "Roasting dulls bright colours." },
                    { text: "Steaming - preserves colour and nutrients", correct: true, feedback: "Correct! Steaming is best for retaining colours." },
                    { text: "Boiling - fast and easy", correct: false, feedback: "Boiling can leach out colour." },
                    { text: "Deep frying - crispy texture", correct: false, feedback: "Deep frying won't preserve colours." }
                ]}
            ]
        };

        // Calculate Progress
        function calculateTotalProgress() {
            const total = Object.values(state.progress).reduce((a, b) => a + b, 0);
            return Math.round((total / 600) * 100);
        }

        // Render Functions
        function renderHome() {
            const modules = [
                { id: 'quiz', icon: '‚ùì', title: 'Knowledge Quiz', desc: 'Test your understanding', progress: state.progress.quiz },
                { id: 'matching', icon: 'üîó', title: 'Method Matching', desc: 'Match methods to produce', progress: state.progress.matching },
                { id: 'fillBlanks', icon: '‚úèÔ∏è', title: 'Fill the Blanks', desc: 'Complete the sentences', progress: state.progress.fillBlanks },
                { id: 'video', icon: 'üé¨', title: 'Video Learning', desc: 'Watch demonstrations', progress: state.progress.video },
                { id: 'caseStudy', icon: 'üìã', title: 'Case Study', desc: 'Apply your knowledge', progress: state.progress.caseStudy },
                { id: 'reflection', icon: 'üí≠', title: 'ARETE Reflection', desc: 'Personal development', progress: state.progress.reflection }
            ];

            return `
                <div class="p-6 max-w-4xl mx-auto fade-in">
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-8 rounded-2xl mb-8 shadow-lg">
                        <h1 class="text-3xl font-bold mb-2">üç≥ Basic Food Preparation & Cooking</h1>
                        <p class="text-xl opacity-90">Day 1: Independent Learning Module</p>
                        <div class="mt-4 bg-white/20 rounded-lg p-3">
                            <p class="text-sm">Overall Progress: ${calculateTotalProgress()}% Complete</p>
                            <div class="w-full bg-white/30 rounded-full h-3 mt-2">
                                <div class="bg-white rounded-full h-3 transition-all duration-500" style="width: ${calculateTotalProgress()}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${modules.map(m => `
                            <button onclick="navigate('${m.id}')" class="module-card bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all border-l-4 border-orange-500 text-left">
                                <div class="flex items-center gap-4">
                                    <span class="text-4xl">${m.icon}</span>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-lg text-gray-800">${m.title}</h3>
                                        <p class="text-gray-500 text-sm">${m.desc}</p>
                                        <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                            <div class="bg-orange-500 rounded-full h-2 transition-all" style="width: ${m.progress}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </button>
                        `).join('')}
                    </div>
                    <p class="text-center text-gray-400 text-sm mt-8">Progress saves automatically in your browser</p>
                </div>
            `;
        }

        function renderQuiz() {
            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 flex items-center gap-2 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-6">‚ùì Knowledge Quiz</h2>
                    ${quizQuestions.map((q, idx) => `
                        <div class="bg-white p-5 rounded-xl shadow mb-4">
                            <p class="font-semibold mb-3">${idx + 1}. ${q.question}</p>
                            <div class="space-y-2">
                                ${q.options.map((opt, i) => `
                                    <label class="flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${
                                        state.quizAnswers[q.id] === i 
                                            ? 'bg-orange-100 border-2 border-orange-500' 
                                            : 'bg-gray-50 hover:bg-gray-100 border-2 border-transparent'
                                    } ${state.showFeedback && i === q.correct ? 'bg-green-100 border-green-500' : ''} 
                                    ${state.showFeedback && state.quizAnswers[q.id] === i && i !== q.correct ? 'bg-red-100 border-red-500' : ''}">
                                        <input type="radio" name="q${q.id}" ${state.quizAnswers[q.id] === i ? 'checked' : ''} 
                                            onchange="handleQuizAnswer(${q.id}, ${i})" ${state.showFeedback ? 'disabled' : ''} class="w-4 h-4 text-orange-600">
                                        <span>${opt}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                    ${!state.showFeedback ? `
                        <button onclick="submitQuiz()" class="w-full bg-orange-500 text-white py-3 rounded-xl font-semibold hover:bg-orange-600 transition">Submit Quiz</button>
                    ` : `
                        <div class="bg-green-100 p-4 rounded-xl text-center">
                            <p class="text-xl font-bold text-green-800">Score: ${state.progress.quiz}% (${state.progress.quiz / 20}/5 correct)</p>
                            <button onclick="resetQuiz()" class="mt-3 text-orange-600 hover:underline">Try Again</button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderMatching() {
            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-2">üîó Match Methods to Produce</h2>
                    <p class="text-gray-600 mb-6">Select the best produce for each cooking method</p>
                    ${matchingPairs.map(pair => `
                        <div class="bg-white p-5 rounded-xl shadow mb-4">
                            <p class="font-semibold text-lg mb-3">${pair.method}</p>
                            <div class="grid grid-cols-2 gap-2">
                                ${matchingPairs.map(p => `
                                    <button onclick="handleMatching(${pair.id}, ${p.id})" ${state.showFeedback ? 'disabled' : ''}
                                        class="p-3 rounded-lg text-left transition-all ${
                                            state.matchingSelections[pair.id] === p.id
                                                ? 'bg-orange-100 border-2 border-orange-500'
                                                : 'bg-gray-50 hover:bg-gray-100 border-2 border-transparent'
                                        } ${state.showFeedback && p.id === pair.id ? 'bg-green-100 border-green-500' : ''}">
                                        ${p.produce}
                                    </button>
                                `).join('')}
                            </div>
                            ${state.showFeedback && state.matchingSelections[pair.id] === pair.id ? `
                                <p class="mt-2 text-sm text-green-700 bg-green-50 p-2 rounded">‚úì ${pair.explanation}</p>
                            ` : ''}
                        </div>
                    `).join('')}
                    ${!state.showFeedback ? `
                        <button onclick="submitMatching()" class="w-full bg-orange-500 text-white py-3 rounded-xl font-semibold hover:bg-orange-600">Check Answers</button>
                    ` : `
                        <div class="bg-green-100 p-4 rounded-xl text-center">
                            <p class="text-xl font-bold text-green-800">Score: ${state.progress.matching}%</p>
                            <button onclick="resetMatching()" class="mt-3 text-orange-600 hover:underline">Try Again</button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderFillBlanks() {
            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-6">‚úèÔ∏è Fill in the Blanks</h2>
                    ${fillBlanksData.map((item, idx) => `
                        <div class="bg-white p-5 rounded-xl shadow mb-4">
                            <p class="mb-3">${idx + 1}. ${item.text.split('___')[0]}
                                <select onchange="handleFillBlank(${item.id}, this.value)" ${state.showFeedback ? 'disabled' : ''}
                                    class="mx-2 p-2 border-2 rounded-lg ${
                                        state.showFeedback && state.fillBlanksAnswers[item.id] === item.answer 
                                            ? 'border-green-500 bg-green-50' 
                                            : state.showFeedback && state.fillBlanksAnswers[item.id] !== item.answer
                                            ? 'border-red-500 bg-red-50'
                                            : 'border-orange-300'
                                    }">
                                    <option value="">Select...</option>
                                    ${item.options.map(opt => `
                                        <option value="${opt}" ${state.fillBlanksAnswers[item.id] === opt ? 'selected' : ''}>${opt}</option>
                                    `).join('')}
                                </select>
                                ${item.text.split('___')[1]}
                            </p>
                            ${state.showFeedback && state.fillBlanksAnswers[item.id] !== item.answer ? `
                                <p class="text-sm text-red-600">Correct answer: ${item.answer}</p>
                            ` : ''}
                        </div>
                    `).join('')}
                    ${!state.showFeedback ? `
                        <button onclick="submitFillBlanks()" class="w-full bg-orange-500 text-white py-3 rounded-xl font-semibold hover:bg-orange-600">Check Answers</button>
                    ` : `
                        <div class="bg-green-100 p-4 rounded-xl text-center">
                            <p class="text-xl font-bold text-green-800">Score: ${state.progress.fillBlanks}%</p>
                            <button onclick="resetFillBlanks()" class="mt-3 text-orange-600 hover:underline">Try Again</button>
                        </div>
                    `}
                </div>
            `;
        }

        function renderVideo() {
            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-6">üé¨ Video Learning</h2>
                    
                    <div class="bg-white p-5 rounded-xl shadow mb-6">
                        <h3 class="font-semibold mb-3">Video 1: Wet Cooking Methods</h3>
                        <div class="aspect-video bg-gray-900 rounded-lg mb-4">
                            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/ZJy1ajvMU1k" 
                                title="Wet Cooking Methods" frameborder="0" allowfullscreen class="rounded-lg"></iframe>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="font-semibold text-orange-800">While watching, consider:</p>
                            <ul class="list-disc ml-5 text-sm text-gray-700 mt-2">
                                <li>How does the water movement differ between methods?</li>
                                <li>What happens to the food's texture in each method?</li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-white p-5 rounded-xl shadow mb-6">
                        <h3 class="font-semibold mb-3">Video 2: Dry Cooking Methods</h3>
                        <div class="aspect-video bg-gray-900 rounded-lg mb-4">
                            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/a-cFyLQLxXM" 
                                title="Dry Cooking Methods" frameborder="0" allowfullscreen class="rounded-lg"></iframe>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="font-semibold text-orange-800">While watching, consider:</p>
                            <ul class="list-disc ml-5 text-sm text-gray-700 mt-2">
                                <li>What creates the browning on food?</li>
                                <li>How do safety practices differ from wet methods?</li>
                            </ul>
                        </div>
                    </div>

                    <button onclick="markVideoComplete()" class="w-full ${state.progress.video === 100 ? 'bg-green-500' : 'bg-orange-500'} text-white py-3 rounded-xl font-semibold hover:opacity-90">
                        ${state.progress.video === 100 ? '‚úì Videos Completed' : 'Mark Videos as Watched'}
                    </button>
                </div>
            `;
        }

        function renderCaseStudy() {
            const q = caseStudy.questions[state.caseStudyQuestion];
            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-4">üìã Restaurant Case Study</h2>
                    
                    <div class="bg-orange-50 p-5 rounded-xl mb-6 border-l-4 border-orange-500">
                        <h3 class="font-semibold mb-2">Scenario:</h3>
                        <p class="text-gray-700">${caseStudy.scenario}</p>
                    </div>

                    <div class="bg-white p-5 rounded-xl shadow">
                        <p class="text-sm text-gray-500 mb-2">Question ${state.caseStudyQuestion + 1} of ${caseStudy.questions.length}</p>
                        <h3 class="font-semibold text-lg mb-4">${q.question}</h3>
                        
                        <div class="space-y-3">
                            ${q.options.map((opt, idx) => `
                                <button onclick="handleCaseStudyAnswer(${idx})" 
                                    ${state.caseStudyAnswers[state.caseStudyQuestion] !== undefined ? 'disabled' : ''}
                                    class="w-full p-4 rounded-lg text-left transition-all ${
                                        state.caseStudyAnswers[state.caseStudyQuestion] === idx
                                            ? opt.correct 
                                                ? 'bg-green-100 border-2 border-green-500'
                                                : 'bg-red-100 border-2 border-red-500'
                                            : 'bg-gray-50 hover:bg-gray-100 border-2 border-transparent'
                                    }">
                                    ${opt.text}
                                </button>
                            `).join('')}
                        </div>

                        ${state.caseStudyFeedback ? `
                            <div class="mt-4 p-4 rounded-lg ${
                                q.options[state.caseStudyAnswers[state.caseStudyQuestion]]?.correct
                                    ? 'bg-green-50 text-green-800'
                                    : 'bg-red-50 text-red-800'
                            }">
                                ${state.caseStudyFeedback}
                            </div>
                        ` : ''}

                        ${state.caseStudyAnswers[state.caseStudyQuestion] !== undefined && state.caseStudyQuestion < caseStudy.questions.length - 1 ? `
                            <button onclick="nextCaseStudyQuestion()" class="mt-4 w-full bg-orange-500 text-white py-3 rounded-xl font-semibold hover:bg-orange-600">
                                Next Question ‚Üí
                            </button>
                        ` : ''}

                        ${state.caseStudyAnswers[state.caseStudyQuestion] !== undefined && state.caseStudyQuestion === caseStudy.questions.length - 1 ? `
                            <div class="mt-4 bg-green-100 p-4 rounded-xl text-center">
                                <p class="text-xl font-bold text-green-800">Case Study Complete! ‚úì</p>
                                <button onclick="resetCaseStudy()" class="mt-3 text-orange-600 hover:underline">Try Again</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderReflection() {
            const prompts = [
                { id: 'selfAwareness', layer: 'Layer 1: Self-Awareness', question: "What did you find easiest about today's learning? What was most challenging?" },
                { id: 'practicalJudgment', layer: 'Layer 3: Practical Judgment', question: 'Which cooking method interests you most and why?' },
                { id: 'adaptability', layer: 'Layer 7: Adaptability', question: "If your preferred method wasn't available, how would you adapt?" },
                { id: 'purpose', layer: 'Layer 8: Purpose', question: "How does today's learning connect to your career goals?" }
            ];

            return `
                <div class="p-6 max-w-3xl mx-auto fade-in">
                    <button onclick="navigate('home')" class="text-orange-600 mb-4 hover:underline">‚Üê Back to Home</button>
                    <h2 class="text-2xl font-bold mb-2">üí≠ ARETE Reflection Journal</h2>
                    <p class="text-gray-600 mb-6">Build professional development alongside technical skills</p>
                    
                    ${prompts.map(item => `
                        <div class="bg-white p-5 rounded-xl shadow mb-4">
                            <h3 class="font-semibold text-orange-600 mb-2">${item.layer}</h3>
                            <p class="text-gray-700 mb-3">${item.question}</p>
                            <textarea id="reflection-${item.id}" oninput="handleReflection('${item.id}', this.value)"
                                placeholder="Write your reflection here..."
                                class="w-full h-24 p-3 border-2 border-gray-200 rounded-lg focus:border-orange-500 focus:outline-none resize-none">${state.reflectionText[item.id] || ''}</textarea>
                        </div>
                    `).join('')}

                    <button onclick="saveReflections()" class="w-full ${state.progress.reflection === 100 ? 'bg-green-500' : 'bg-orange-500'} text-white py-3 rounded-xl font-semibold hover:opacity-90">
                        ${state.progress.reflection === 100 ? '‚úì Reflections Saved' : 'Save Reflections'}
                    </button>
                </div>
            `;
        }

        // Event Handlers
        function navigate(module) {
            state.currentModule = module;
            state.showFeedback = false;
            render();
        }

        function handleQuizAnswer(questionId, answerIndex) {
            state.quizAnswers[questionId] = answerIndex;
            render();
        }

        function submitQuiz() {
            let score = 0;
            quizQuestions.forEach(q => {
                if (state.quizAnswers[q.id] === q.correct) score++;
            });
            state.progress.quiz = score * 20;
            state.showFeedback = true;
            saveProgress();
            render();
        }

        function resetQuiz() {
            state.quizAnswers = {};
            state.showFeedback = false;
            render();
        }

        function handleMatching(methodId, produceId) {
            state.matchingSelections[methodId] = produceId;
            render();
        }

        function submitMatching() {
            let score = 0;
            matchingPairs.forEach(pair => {
                if (state.matchingSelections[pair.id] === pair.id) score++;
            });
            state.progress.matching = score * 20;
            state.showFeedback = true;
            saveProgress();
            render();
        }

        function resetMatching() {
            state.matchingSelections = {};
            state.showFeedback = false;
            render();
        }

        function handleFillBlank(id, answer) {
            state.fillBlanksAnswers[id] = answer;
            render();
        }

        function submitFillBlanks() {
            let score = 0;
            fillBlanksData.forEach(item => {
                if (state.fillBlanksAnswers[item.id] === item.answer) score++;
            });
            state.progress.fillBlanks = score * 20;
            state.showFeedback = true;
            saveProgress();
            render();
        }

        function resetFillBlanks() {
            state.fillBlanksAnswers = {};
            state.showFeedback = false;
            render();
        }

        function markVideoComplete() {
            state.progress.video = 100;
            saveProgress();
            render();
        }

        function handleCaseStudyAnswer(optionIndex) {
            const q = caseStudy.questions[state.caseStudyQuestion];
            state.caseStudyAnswers[state.caseStudyQuestion] = optionIndex;
            state.caseStudyFeedback = q.options[optionIndex].feedback;
            
            if (q.options[optionIndex].correct && state.caseStudyQuestion === caseStudy.questions.length - 1) {
                state.progress.caseStudy = 100;
                saveProgress();
            }
            render();
        }

        function nextCaseStudyQuestion() {
            state.caseStudyQuestion++;
            state.caseStudyFeedback = null;
            render();
        }

        function resetCaseStudy() {
            state.caseStudyQuestion = 0;
            state.caseStudyAnswers = {};
            state.caseStudyFeedback = null;
            render();
        }

        function handleReflection(id, value) {
            state.reflectionText[id] = value;
        }

        function saveReflections() {
            state.progress.reflection = 100;
            saveProgress();
            alert('Reflections saved successfully!');
            render();
        }

        // Main Render
        function render() {
            const app = document.getElementById('app');
            switch(state.currentModule) {
                case 'quiz': app.innerHTML = renderQuiz(); break;
                case 'matching': app.innerHTML = renderMatching(); break;
                case 'fillBlanks': app.innerHTML = renderFillBlanks(); break;
                case 'video': app.innerHTML = renderVideo(); break;
                case 'caseStudy': app.innerHTML = renderCaseStudy(); break;
                case 'reflection': app.innerHTML = renderReflection(); break;
                default: app.innerHTML = renderHome();
            }
        }

        // Initialize
        loadProgress();
        render();
    </script>
</body>
</html>
